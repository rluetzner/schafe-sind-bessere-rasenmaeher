<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href="/css/readable.min.css?v=v1.1.0"><meta name=description content><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><title>Schafe sind bessere Rasenmäher | Docker builds are not reproducible</title>
<meta name=fediverse:creator content="@mforester@rollenspiel.social"></head><body><header><h1>Schafe sind bessere Rasenmäher</h1><p>...ist einfach so!</p><figure><a href=/><img width=100 height=100 src=/images/schaf-rund.webp alt></a></figure><nav data-style=classy><span><a href=/posts/>Stuff</a>
</span><span><a href=/tech/>Tech</a>
</span><span><a href=/mindfulness/>Mindfulness</a>
</span><span><a href=/stories/>Geschichten</a></span></nav></header><main><h1>Docker builds are not reproducible</h1><i data-feather=calendar></i>
<time datetime=2022-10-16>16. Oct 2022</time><br><b>Tags: </b><i data-feather=tag></i>
<a class="btn btn-sm btn-outline-dark tag-btn" href=/tags/docker>docker</a><br><b>Estimated reading time: </b>2 minutes<article><aside><p><p><strong>TL;DR</strong></p><p>If your Docker build depends on installing packages from an external package repository, you might be in for a surprise.</p><p>A possible solution is to copy cached layers from an existing machine to a new one.</p></p></aside><p>I&rsquo;ll probably out myself as an absolute idiot, but Docker builds are far from reproducible.</p><p>Recently I had to setup a new Jenkins node at work and to verify that everything works correctly, I ran our build process. To my surprise the build step creating and exporting a Docker image failed.</p><p>After some research I realized that although the base image was still available (we&rsquo;re using SUSE Linux 15.2) some of the package repos no longer exist. The build step wasn&rsquo;t failing on the other Jenkins nodes because all Docker build steps were <strong>cached</strong>.</p><p>I ran through a couple of options.</p><ol><li>The best option to my mind would be to push the created image (or even the cached intermediary layers) to an internal registry. This would fix the problem for newer releases, but we often have to build older versions of our software and backporting this fix everywhere would be a real pain.</li><li>Another option I attempted, but failed, was to export the intermediary layers on one of the existing Jenkins nodes and import them on the new one. They will however not be picked up by the build cache, so the problem still persists.</li><li>The final option, which seemed overkill, was to pack all overlay folders into a tarball and extract that on the new machine. I honestly didn&rsquo;t expect this to work, but the Docker build cache detected the layers as existing and suddenly the build finished successfully.</li></ol><p>In hindsight it should have been obvious that something like this would happen eventually. Being relatively new to the Linux world, I didn&rsquo;t expect packages to vanish from a repository or &ndash; even worse &ndash; the entire package repository to be gone. SUSE is a weird one at that, as it feels to me like other distributions keep their package repositories around for much longer, even when they run out of support. That might however also be a wrong assumption on my part.</p><hr><p>Did you like what you read? Let me hear your thoughts.</p><p><ul><li><a href="mailto:robert@luetzners.de?subject=Post%20%22Docker%20builds%20are%20not%20reproducible%22">Send me an email</a></li><li><a href=https://rollenspiel.social/@mforester>Reply on the Fediverse</a></li></ul></p></article><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png></a><br><span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text property="dct:title" rel=dct:type><i>Docker builds are not reproducible</i></span> written by <a xmlns:cc=http://creativecommons.org/ns# href=/tech/docker-builds-are-not-reproducible/ property="cc:attributionName" rel=cc:attributionURL>Robert Lützner</a> is licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>Creative Commons Attribution - NonCommercial - ShareAlike 4.0 International license</a>.</main><footer><p>© 2025 Robert Lützner</p><a href=https://rollenspiel.social/@mforester rel=me target=blank>Mastodon</a> | <a href=https://codeberg.org/rluetzner>Codeberg</a> | <a href=/imprint/>Contact Me</a> | <a href=/rss>RSS Feeds</a> | <a href=/imprint>Imprint</a></p></footer></body></html>