<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href="/css/readable.min.css?v=v1.1.0"><meta name=description content><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><title>Schafe sind bessere RasenmÃ¤her | Routing to other servers with Traefik</title>
<meta name=fediverse:creator content="@mforester@rollenspiel.social"></head><body><header><h1>Schafe sind bessere RasenmÃ¤her</h1><p>...ist einfach so!</p><figure><a href=/><img width=100 height=100 src=/images/schaf-rund.webp alt></a></figure><nav data-style=classy><span><a href=/posts/>Stuff</a>
</span><span><a href=/tech/>Tech</a>
</span><span><a href=/mindfulness/>Mindfulness</a>
</span><span><a href=/stories/>Geschichten</a></span></nav></header><main><h1>Routing to other servers with Traefik</h1><i data-feather=calendar></i>
<time datetime=2024-09-02>2. Sep 2024</time><br><b>Tags: </b><i data-feather=tag></i>
<a class="btn btn-sm btn-outline-dark tag-btn" href=/tags/traefik>traefik</a>
<a class="btn btn-sm btn-outline-dark tag-btn" href=/tags/homelab>homelab</a><br><b>Estimated reading time: </b>4 minutes<article><p>I recently added <a href=https://immich.app>Immich</a> to my homelab. To be precise: I added it to the 30 or so Docker containers that were already running on my Raspberry Pi 4 &ndash; and it finally caused my already wobbly setup to collapse.</p><p>Immich comes with multiple containers, one of which is solely responsible for generating a local A.I. model to match people in photos. I tried a few ways to limit resources on the containers, but other services still kept crashing and the whole system became unresponsive. Oftentimes I couldn&rsquo;t even SSH into it anymore.</p><p>The easiest and quickest solution would have been to get rid of Immich. But Immich is just so much fun to use! Seriously, it makes me want to clean up my photo library which I&rsquo;ve been meaning to do for years now. It is so much better than Nextcloud Photos, which I used before.</p><p>Luckily I still had a Pi 3 lying around, so I decided to finally look into how to route to other servers using Traefik.</p><p>As it turns out, it&rsquo;s actually pretty easy.</p><aside><p>I&rsquo;ve been using Traefik for well over four years now, but I never really bothered to try and understand it&rsquo;s configuration. I copied a static config file when I started out and pretty much forgot about it&rsquo;s existence. Eventually I figured out the right Docker labels for Traefik to route to my services and I&rsquo;ve been copying those around ever since.</p></aside><p>Aside from it&rsquo;s <em>static</em> configuration file, Traefik also allows us to define dynamic configuration parts either as Docker labels or in a file.</p><blockquote><p>The difference between <em>static</em> and <em>dynamic</em> is a bit muddy.<br>Basically the <em>static</em> part is meant for things that rarely change, e.g. your <code>certsProvider</code> or <code>entrypoints</code>.<br>The <em>dynamic</em> config is for pieces that can change frequently, e.g. <code>routers</code>.</p></blockquote><p>First, we&rsquo;ll need to declare our dynamic config file in the <em>static</em> configuration. Put this into your config file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>providers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>directory</span>: <span style=color:#ae81ff>/etc/traefik/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>watch</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><blockquote><p>I&rsquo;m using a YAML format here, but Traefik also supports TOML. The transformation should be straightforward.</p></blockquote><p>Now we can get started on our dynamic config. Let&rsquo;s create a file <code>dynamic.yml</code> with the following content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>routers</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>forgejo-secure</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>tls</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>rule</span>: <span style=color:#e6db74>&#34;Host(`forgejo.example.com`)&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entrypoints</span>: <span style=color:#ae81ff>websecure</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>: <span style=color:#ae81ff>forgejo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>forgejo</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>loadbalancer</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>servers</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://192.168.0.11:3000&#34;</span>
</span></span></code></pre></div><p>I&rsquo;m using <a href=https://forgejo.org>Forgejo</a> as an example, but you can of course use any other service and certainly define multiple routes in the same <em>dynamic</em> config file.</p><p>Here are the things that are specific to my setup:</p><ul><li>You&rsquo;ll need to adjust <code>forgejo.example.com</code> to your domain and service. I&rsquo;m using a subdomain, but you could also route via path segments.</li><li>The <code>websecure</code> entrypoint is my HTTPS entrypoint defined in my <em>static</em> config file.</li><li>The name of the <code>forgejo</code> service on the router needs to match the service that&rsquo;s defined later on in the same file.</li><li>My Pi 3 uses the IP <code>192.168.0.11</code>. This should be the IP of the server you want to route to.</li><li>I&rsquo;ve assigned port <code>3000</code> to Forgejo&rsquo;s web UI.</li></ul><p>The last thing left to do is to tie this into your <code>docker-compose.yml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>traefik</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;traefik:latest&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#e6db74>&#34;traefik&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./config/traefik.yml:/traefik.yml:ro</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># This line here!!!</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./dynamic.yml:/etc/traefik/dynamic_conf.yml:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span></code></pre></div><p>This literally took me longer to write than read up on and execute when I moved my services.</p><p>Another thing that came in to help was <a href=https://github.com/henrygd/beszel>Beszel</a>. Beszel is a <strong>very</strong> lightweight and simple monitoring service. It shows metrics for Docker containers too, which helped me identify a few services that I could move from my Pi 4 to the Pi 3 without stressing the less powerful system too much.</p><p>The end result is night and day. My Pi 4 is now noticeably more responsive, which is something all the remaining services benefit from. At the same time my Pi 3 is purring along nicely with things I use less frequently.</p><p>By the way, if you&rsquo;re wondering about my setup on the Pi 3, it&rsquo;s now running all the containers in their own separate networks with ports mapped and exposed on the host. I didn&rsquo;t think it&rsquo;d be necessary to complicate things by putting in another reverse proxy on a host that&rsquo;s not directly exposed to the internet. I&rsquo;m not afraid of attackers in my home network, but your security demands might vary. Keep that in mind.</p><p>Thanks for reading. ðŸ™‚</p><hr><p>Did you like what you read? Let me hear your thoughts.</p><p><ul><li><a href="mailto:robert@luetzners.de?subject=Post%20%22Routing%20to%20other%20servers%20with%20Traefik%22">Send me an email</a></li><li><a href=https://rollenspiel.social/@mforester>Reply on the Fediverse</a></li></ul></p></article><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png></a><br><span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text property="dct:title" rel=dct:type><i>Routing to other servers with Traefik</i></span> written by <a xmlns:cc=http://creativecommons.org/ns# href=/tech/routing-to-other-servers-with-traefik/ property="cc:attributionName" rel=cc:attributionURL>Robert LÃ¼tzner</a> is licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>Creative Commons Attribution - NonCommercial - ShareAlike 4.0 International license</a>.</main><footer><p>Â© 2025 Robert LÃ¼tzner</p><a href=https://rollenspiel.social/@mforester rel=me target=blank>Mastodon</a> | <a href=https://codeberg.org/rluetzner>Codeberg</a> | <a href=/imprint/>Contact Me</a> | <a href=/rss>RSS Feeds</a> | <a href=/imprint>Imprint</a></p></footer></body></html>